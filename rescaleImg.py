### import libs ###
import numpy as np
from PIL import Image
# import matplotlib as mpl
# import matplotlib.pyplot as plt
imgArray = np.array([[[48,48,48],[60,60,60],[64,64,64],[73,73,73],[65,65,65],[58,58,58],[86,86,86],[71,71,71],[46,46,46],[53,53,53],[57,57,57],[53,53,53],[51,51,51],[56,56,56],[60,60,60],[35,35,35],[43,43,43],[67,67,67],[45,45,45],[75,75,75],[170,170,170],[158,158,158],[118,118,118],[171,171,171],[129,129,129],[44,44,44],[18,18,18],[40,40,40],[59,59,59],[68,68,68],[37,37,37],[20,20,20],[85,85,85],[102,102,102],[61,61,61],[45,45,45],[53,53,53],[41,41,41],[87,87,87],[68,68,68]],[[67,67,67],[78,78,78],[62,62,62],[63,63,63],[83,83,83],[86,86,86],[83,83,83],[95,95,95],[78,78,78],[78,78,78],[65,65,65],[55,55,55],[57,57,57],[55,55,55],[36,36,36],[89,89,89],[62,62,62],[24,24,24],[30,30,30],[54,54,54],[74,74,74],[93,93,93],[132,132,132],[134,134,134],[103,103,103],[54,54,54],[35,35,35],[58,58,58],[61,61,61],[19,19,19],[3,3,3],[28,28,28],[64,64,64],[50,50,50],[31,31,31],[31,31,31],[45,45,45],[67,67,67],[77,77,77],[19,19,19]],[[80,80,80],[86,86,86],[73,73,73],[73,73,73],[97,97,97],[110,110,110],[75,75,75],[97,97,97],[101,101,101],[96,96,96],[83,83,83],[52,52,52],[42,42,42],[81,81,81],[37,37,37],[144,144,144],[128,128,128],[3,3,3],[53,53,53],[89,89,89],[24,24,24],[1,1,1],[66,66,66],[51,51,51],[49,49,49],[77,77,77],[98,98,98],[22,22,22],[0,0,0],[63,63,63],[141,141,141],[127,127,127],[84,84,84],[48,48,48],[71,71,71],[126,126,126],[151,151,151],[130,130,130],[108,108,108],[63,63,63]],[[116,116,116],[112,112,112],[115,115,115],[127,127,127],[138,138,138],[129,129,129],[92,92,92],[74,74,74],[109,109,109],[101,101,101],[100,100,100],[65,65,65],[98,98,98],[111,111,111],[93,93,93],[79,79,79],[65,65,65],[37,37,37],[39,39,39],[5,5,5],[0,0,0],[33,33,33],[51,51,51],[14,14,14],[0,0,0],[74,74,74],[162,162,162],[86,86,86],[149,149,149],[228,228,228],[205,205,205],[125,125,125],[112,112,112],[180,180,180],[208,208,208],[218,218,218],[204,204,204],[211,211,211],[218,218,218],[228,228,228]],[[134,134,134],[138,138,138],[158,158,158],[143,143,143],[113,113,113],[138,138,138],[149,149,149],[73,73,73],[58,58,58],[95,95,95],[143,143,143],[98,98,98],[102,102,102],[76,76,76],[83,83,83],[80,80,80],[33,33,33],[43,43,43],[32,32,32],[67,67,67],[108,108,108],[49,49,49],[54,54,54],[116,116,116],[76,76,76],[27,27,27],[194,194,194],[255,255,255],[255,255,255],[126,126,126],[0,0,0],[45,45,45],[222,222,222],[251,251,251],[185,185,185],[180,180,180],[212,212,212],[196,196,196],[177,177,177],[126,126,126]],[[92,92,92],[142,142,142],[125,125,125],[111,111,111],[106,106,106],[136,136,136],[135,135,135],[56,56,56],[3,3,3],[15,15,15],[175,175,175],[137,137,137],[41,41,41],[36,36,36],[32,32,32],[76,76,76],[55,55,55],[56,56,56],[38,38,38],[82,82,82],[144,144,144],[68,68,68],[60,60,60],[118,118,118],[50,50,50],[70,70,70],[216,216,216],[243,243,243],[69,69,69],[0,0,0],[3,3,3],[188,188,188],[239,239,239],[115,115,115],[88,88,88],[187,187,187],[186,186,186],[140,140,140],[117,117,117],[0,0,0]],[[69,69,69],[133,133,133],[97,97,97],[98,98,98],[132,132,132],[143,143,143],[124,124,124],[71,71,71],[23,23,23],[43,43,43],[42,42,42],[46,46,46],[66,66,66],[42,42,42],[16,16,16],[75,75,75],[75,75,75],[38,38,38],[51,51,51],[23,23,23],[24,24,24],[20,20,20],[30,30,30],[45,45,45],[68,68,68],[177,177,177],[255,255,255],[117,117,117],[10,10,10],[20,20,20],[32,32,32],[127,127,127],[122,122,122],[7,7,7],[66,66,66],[111,111,111],[45,45,45],[39,39,39],[27,27,27],[20,20,20]],[[52,52,52],[84,84,84],[80,80,80],[102,102,102],[128,128,128],[129,129,129],[114,114,114],[63,63,63],[22,22,22],[40,40,40],[19,19,19],[35,35,35],[64,64,64],[19,19,19],[9,9,9],[65,65,65],[71,71,71],[136,136,136],[127,127,127],[48,48,48],[39,39,39],[86,86,86],[115,115,115],[178,178,178],[203,203,203],[255,255,255],[193,193,193],[18,18,18],[53,53,53],[62,62,62],[26,26,26],[49,49,49],[49,49,49],[33,33,33],[44,44,44],[35,35,35],[11,11,11],[50,50,50],[85,85,85],[62,62,62]],[[30,30,30],[46,46,46],[13,13,13],[52,52,52],[95,95,95],[89,89,89],[66,66,66],[60,60,60],[20,20,20],[50,50,50],[56,56,56],[61,61,61],[57,57,57],[38,38,38],[34,34,34],[59,59,59],[112,112,112],[154,154,154],[89,89,89],[49,49,49],[105,105,105],[152,152,152],[96,96,96],[99,99,99],[182,182,182],[249,249,249],[82,82,82],[13,13,13],[31,31,31],[78,78,78],[122,122,122],[62,62,62],[0,0,0],[1,1,1],[39,39,39],[4,4,4],[46,46,46],[128,128,128],[143,143,143],[78,78,78]],[[78,78,78],[110,110,110],[90,90,90],[104,104,104],[106,106,106],[75,75,75],[63,63,63],[70,70,70],[52,52,52],[40,40,40],[79,79,79],[67,67,67],[50,50,50],[75,75,75],[61,61,61],[54,54,54],[153,153,153],[102,102,102],[33,33,33],[51,51,51],[87,87,87],[100,100,100],[62,62,62],[6,6,6],[60,60,60],[90,90,90],[78,78,78],[40,40,40],[5,5,5],[94,94,94],[129,129,129],[35,35,35],[0,0,0],[12,12,12],[17,17,17],[10,10,10],[74,74,74],[71,71,71],[61,61,61],[94,94,94]],[[143,143,143],[162,162,162],[112,112,112],[145,145,145],[119,119,119],[101,101,101],[116,116,116],[54,54,54],[23,23,23],[11,11,11],[62,62,62],[42,42,42],[13,13,13],[69,69,69],[56,56,56],[51,51,51],[120,120,120],[62,62,62],[35,35,35],[20,20,20],[54,54,54],[100,100,100],[67,67,67],[1,1,1],[2,2,2],[26,26,26],[81,81,81],[32,32,32],[9,9,9],[70,70,70],[94,94,94],[94,94,94],[38,38,38],[7,7,7],[16,16,16],[57,57,57],[106,106,106],[115,115,115],[102,102,102],[70,70,70]],[[101,101,101],[89,89,89],[61,61,61],[79,79,79],[61,61,61],[94,94,94],[130,130,130],[39,39,39],[49,49,49],[93,93,93],[46,46,46],[43,43,43],[114,114,114],[85,85,85],[31,31,31],[56,56,56],[56,56,56],[11,11,11],[38,38,38],[12,12,12],[63,63,63],[125,125,125],[33,33,33],[0,0,0],[10,10,10],[37,37,37],[61,61,61],[12,12,12],[2,2,2],[74,74,74],[93,93,93],[104,104,104],[51,51,51],[13,13,13],[28,28,28],[84,84,84],[141,141,141],[140,140,140],[122,122,122],[74,74,74]],[[1,1,1],[0,0,0],[5,5,5],[18,18,18],[12,12,12],[3,3,3],[85,85,85],[66,66,66],[118,118,118],[129,129,129],[66,66,66],[90,90,90],[126,126,126],[50,50,50],[2,2,2],[44,44,44],[106,106,106],[39,39,39],[55,55,55],[69,69,69],[30,30,30],[71,71,71],[23,23,23],[0,0,0],[9,9,9],[87,87,87],[143,143,143],[109,109,109],[68,68,68],[53,53,53],[58,58,58],[94,94,94],[35,35,35],[22,22,22],[25,25,25],[55,55,55],[107,107,107],[86,86,86],[74,74,74],[53,53,53]],[[16,16,16],[33,33,33],[41,41,41],[43,43,43],[85,85,85],[60,60,60],[21,21,21],[84,84,84],[103,103,103],[44,44,44],[77,77,77],[73,73,73],[66,66,66],[45,45,45],[7,7,7],[25,25,25],[140,140,140],[182,182,182],[123,123,123],[39,39,39],[72,72,72],[68,68,68],[48,48,48],[96,96,96],[165,165,165],[95,95,95],[106,106,106],[163,163,163],[132,132,132],[32,32,32],[23,23,23],[106,106,106],[92,92,92],[31,31,31],[51,51,51],[31,31,31],[66,66,66],[69,69,69],[18,18,18],[32,32,32]],[[18,18,18],[30,30,30],[34,34,34],[42,42,42],[85,85,85],[52,52,52],[29,29,29],[106,106,106],[92,92,92],[61,61,61],[102,102,102],[67,67,67],[67,67,67],[91,91,91],[63,63,63],[53,53,53],[57,57,57],[147,147,147],[131,131,131],[11,11,11],[136,136,136],[59,59,59],[32,32,32],[144,144,144],[146,146,146],[47,47,47],[5,5,5],[13,13,13],[119,119,119],[80,80,80],[51,51,51],[106,106,106],[99,99,99],[44,44,44],[32,32,32],[20,20,20],[20,20,20],[27,27,27],[8,8,8],[80,80,80]],[[27,27,27],[53,53,53],[54,54,54],[46,46,46],[34,34,34],[32,32,32],[40,40,40],[64,64,64],[75,75,75],[63,63,63],[61,61,61],[35,35,35],[64,64,64],[59,59,59],[11,11,11],[33,33,33],[85,85,85],[62,62,62],[109,109,109],[197,197,197],[110,110,110],[12,12,12],[66,66,66],[69,69,69],[35,35,35],[62,62,62],[66,66,66],[122,122,122],[234,234,234],[165,165,165],[33,33,33],[80,80,80],[79,79,79],[30,30,30],[108,108,108],[82,82,82],[0,0,0],[1,1,1],[35,35,35],[165,165,165]],[[19,19,19],[33,33,33],[31,31,31],[32,32,32],[38,38,38],[40,40,40],[5,5,5],[100,100,100],[92,92,92],[104,104,104],[150,150,150],[114,114,114],[66,66,66],[80,80,80],[41,41,41],[22,22,22],[74,74,74],[85,85,85],[168,168,168],[162,162,162],[51,51,51],[17,17,17],[64,64,64],[66,66,66],[32,32,32],[44,44,44],[43,43,43],[206,206,206],[255,255,255],[239,239,239],[55,55,55],[1,1,1],[98,98,98],[65,65,65],[125,125,125],[215,215,215],[143,143,143],[97,97,97],[52,52,52],[239,239,239]],[[17,17,17],[31,31,31],[30,30,30],[36,36,36],[33,33,33],[45,45,45],[33,33,33],[106,106,106],[87,87,87],[68,68,68],[118,118,118],[80,80,80],[13,13,13],[51,51,51],[137,137,137],[129,129,129],[85,85,85],[72,72,72],[35,35,35],[31,31,31],[60,60,60],[2,2,2],[40,40,40],[73,73,73],[41,41,41],[53,53,53],[81,81,81],[230,230,230],[164,164,164],[96,96,96],[119,119,119],[1,1,1],[146,146,146],[243,243,243],[103,103,103],[164,164,164],[185,185,185],[175,175,175],[215,215,215],[96,96,96]],[[7,7,7],[34,34,34],[42,42,42],[24,24,24],[32,32,32],[41,41,41],[29,29,29],[97,97,97],[103,103,103],[65,65,65],[28,28,28],[35,35,35],[34,34,34],[8,8,8],[65,65,65],[208,208,208],[212,212,212],[155,155,155],[111,111,111],[125,125,125],[123,123,123],[113,113,113],[76,76,76],[45,45,45],[85,85,85],[51,51,51],[153,153,153],[238,238,238],[81,81,81],[0,0,0],[85,85,85],[93,93,93],[96,96,96],[161,161,161],[130,130,130],[162,162,162],[134,134,134],[70,70,70],[211,211,211],[0,0,0]],[[2,2,2],[6,6,6],[18,18,18],[4,4,4],[17,17,17],[14,14,14],[76,76,76],[120,120,120],[98,98,98],[121,121,121],[104,104,104],[79,79,79],[52,52,52],[29,29,29],[6,6,6],[129,129,129],[234,234,234],[198,198,198],[205,205,205],[211,211,211],[204,204,204],[216,216,216],[186,186,186],[116,116,116],[105,105,105],[115,115,115],[203,203,203],[144,144,144],[38,38,38],[47,47,47],[56,56,56],[55,55,55],[130,130,130],[92,92,92],[90,90,90],[178,178,178],[158,158,158],[62,62,62],[202,202,202],[47,47,47]],[[104,104,104],[107,107,107],[110,110,110],[119,119,119],[123,123,123],[120,120,120],[197,197,197],[121,121,121],[34,34,34],[108,108,108],[129,129,129],[74,74,74],[14,14,14],[39,39,39],[19,19,19],[96,96,96],[234,234,234],[203,203,203],[201,201,201],[199,199,199],[204,204,204],[195,195,195],[202,202,202],[211,211,211],[184,184,184],[217,217,217],[175,175,175],[91,91,91],[82,82,82],[74,74,74],[10,10,10],[0,0,0],[168,168,168],[123,123,123],[50,50,50],[188,188,188],[133,133,133],[65,65,65],[207,207,207],[74,74,74]],[[198,198,198],[213,213,213],[215,215,215],[217,217,217],[216,216,216],[213,213,213],[243,243,243],[180,180,180],[77,77,77],[51,51,51],[128,128,128],[135,135,135],[26,26,26],[27,27,27],[42,42,42],[83,83,83],[219,219,219],[227,227,227],[214,214,214],[217,217,217],[219,219,219],[199,199,199],[200,200,200],[230,230,230],[214,214,214],[209,209,209],[218,218,218],[240,240,240],[246,246,246],[209,209,209],[160,160,160],[142,142,142],[171,171,171],[117,117,117],[42,42,42],[128,128,128],[75,75,75],[35,35,35],[189,189,189],[209,209,209]],[[180,180,180],[177,177,177],[185,185,185],[195,195,195],[203,203,203],[208,208,208],[235,235,235],[195,195,195],[31,31,31],[5,5,5],[64,64,64],[84,84,84],[34,34,34],[45,45,45],[35,35,35],[27,27,27],[184,184,184],[242,242,242],[221,221,221],[215,215,215],[216,216,216],[225,225,225],[236,236,236],[232,232,232],[232,232,232],[228,228,228],[233,233,233],[231,231,231],[234,234,234],[240,240,240],[255,255,255],[255,255,255],[220,220,220],[204,204,204],[194,194,194],[173,173,173],[162,162,162],[151,151,151],[155,155,155],[240,240,240]],[[142,142,142],[155,155,155],[169,169,169],[183,183,183],[201,201,201],[195,195,195],[223,223,223],[199,199,199],[52,52,52],[3,3,3],[44,44,44],[74,74,74],[32,32,32],[34,34,34],[54,54,54],[61,61,61],[184,184,184],[227,227,227],[215,215,215],[215,215,215],[219,219,219],[215,215,215],[211,211,211],[215,215,215],[215,215,215],[220,220,220],[216,216,216],[209,209,209],[213,213,213],[216,216,216],[215,215,215],[213,213,213],[216,216,216],[223,223,223],[226,226,226],[225,225,225],[229,229,229],[225,225,225],[193,193,193],[216,216,216]],[[148,148,148],[173,173,173],[180,180,180],[173,173,173],[186,186,186],[195,195,195],[206,206,206],[211,211,211],[112,112,112],[20,20,20],[108,108,108],[110,110,110],[17,17,17],[54,54,54],[76,76,76],[83,83,83],[223,223,223],[227,227,227],[201,201,201],[202,202,202],[213,213,213],[196,196,196],[191,191,191],[193,193,193],[190,190,190],[188,188,188],[188,188,188],[179,179,179],[186,186,186],[193,193,193],[182,182,182],[185,185,185],[180,180,180],[185,185,185],[192,192,192],[187,187,187],[186,186,186],[192,192,192],[190,190,190],[193,193,193]],[[180,180,180],[178,178,178],[177,177,177],[178,178,178],[176,176,176],[191,191,191],[199,199,199],[230,230,230],[115,115,115],[8,8,8],[82,82,82],[52,52,52],[7,7,7],[35,35,35],[14,14,14],[32,32,32],[195,195,195],[201,201,201],[169,169,169],[176,176,176],[188,188,188],[193,193,193],[183,183,183],[189,189,189],[195,195,195],[195,195,195],[197,197,197],[188,188,188],[185,185,185],[189,189,189],[190,190,190],[180,180,180],[180,180,180],[186,186,186],[185,185,185],[179,179,179],[179,179,179],[176,176,176],[170,170,170],[189,189,189]],[[151,151,151],[168,168,168],[172,172,172],[170,170,170],[170,170,170],[161,161,161],[193,193,193],[158,158,158],[11,11,11],[5,5,5],[72,72,72],[17,17,17],[1,1,1],[2,2,2],[6,6,6],[30,30,30],[105,105,105],[166,166,166],[183,183,183],[210,210,210],[210,210,210],[206,206,206],[207,207,207],[212,212,212],[211,211,211],[208,208,208],[206,206,206],[208,208,208],[205,205,205],[199,199,199],[200,200,200],[197,197,197],[187,187,187],[190,190,190],[189,189,189],[183,183,183],[179,179,179],[169,169,169],[165,165,165],[199,199,199]],[[142,142,142],[166,166,166],[177,177,177],[169,169,169],[180,180,180],[175,175,175],[193,193,193],[131,131,131],[66,66,66],[111,111,111],[91,91,91],[39,39,39],[59,59,59],[84,84,84],[110,110,110],[101,101,101],[96,96,96],[133,133,133],[151,151,151],[160,160,160],[185,185,185],[197,197,197],[201,201,201],[197,197,197],[197,197,197],[197,197,197],[196,196,196],[194,194,194],[189,189,189],[192,192,192],[195,195,195],[197,197,197],[186,186,186],[188,188,188],[193,193,193],[184,184,184],[182,182,182],[184,184,184],[179,179,179],[192,192,192]],[[151,151,151],[146,146,146],[151,151,153],[168,168,168],[169,169,169],[172,172,170],[172,172,172],[184,184,184],[215,215,215],[196,196,196],[161,161,161],[134,134,134],[117,117,117],[125,125,125],[130,130,130],[136,136,136],[140,140,140],[148,148,148],[149,149,149],[147,147,147],[155,155,155],[187,187,187],[203,203,203],[201,201,201],[194,194,194],[192,192,192],[194,194,194],[195,195,195],[193,193,193],[197,197,197],[190,190,190],[179,179,179],[185,185,185],[187,187,187],[167,167,167],[154,154,154],[157,157,157],[155,155,155],[151,151,151],[197,197,197]],[[160,160,160],[163,163,163],[162,162,164],[169,169,169],[174,174,174],[180,180,178],[187,187,187],[181,181,181],[177,177,177],[187,187,187],[195,195,195],[196,196,196],[174,174,174],[157,157,157],[155,155,155],[159,159,159],[157,157,157],[153,153,153],[156,156,156],[151,151,151],[144,144,144],[154,154,154],[167,167,167],[177,177,177],[173,173,173],[179,179,179],[179,179,179],[175,175,175],[174,174,174],[171,171,171],[166,166,166],[157,157,157],[165,165,165],[167,167,167],[151,151,151],[150,150,150],[135,135,135],[137,137,137],[157,157,157],[171,171,171]]], dtype=np.uint8)
# Minimal code for rendering a numpy array as an image with subplotting

img = Image.fromarray(imgArray, "RGB")
#img.show()

ratio = (5,4)
# 640*480->384 

def index_poids(index, ratio):
    (src, dst) = ratio
    a = index*src/dst
    b = dst-index%dst
    return ((a,b),(a+1,src-b))

# 0 -> ((0,4),(1,1))
# 1 -> ((1,3),(2,2))
# 2 -> ((2,2),(3,3))
# 3 -> ((3,1),(4,4))
# 4 -> ((5,4),(6,1))
# 5 -> ((6,3),(7,2))
# 6 -> ((7,2),(8,3))
# 7 -> ((8,1),(9,4))
# 8 -> ((10,4),(11,1))
for i in range(9):
    index_poids(i,ratio)
                
                
def pixel_poids(pixel, ratio):
    (y,x) = pixel
    ((y1_index,y1_poids),(y2_index,y2_poids)) = index_poids(y,ratio)
    ((x1_index,x1_poids),(x2_index,x2_poids)) = index_poids(x,ratio)
    
    y1x1 = (int(y1_index),int(x1_index),int(y1_poids*x1_poids))
    y1x2 = (int(y1_index),int(x2_index),int(y1_poids*x2_poids))
    y2x1 = (int(y2_index),int(x1_index),int(y2_poids*x1_poids))
    y2x2 = (int(y2_index),int(x2_index),int(y2_poids*x2_poids))
    
    return (y1x1, y1x2, y2x1, y2x2)

# (y, x) (row, col)
# (0,0) -> ((0,0,16),(0,1,4),(1,0,4),(1,1,1))
# (0,1) -> ((0,1,12),(0,2,8),(1,1,3),(1,2,2))
# (1,2) -> ((1,2,6),(1,3,9),(2,2,4),(2,3,6))
# print pixel_poids((0,0), ratio)
# print pixel_poids((0,1), ratio)
# print pixel_poids((1,2), ratio)

def resize(inputImg, ratio):
    (rows, cols, pixelSize) = inputImg.shape
    outputShape = [int(rows*ratio[1]/ratio[0]), int(cols*ratio[1]/ratio[0]), pixelSize]
    (oRows, oCols, pixelSize) = outputShape

    outputImg = np.zeros(outputShape, dtype=np.uint8)
    
    for r in range(oRows):
        for c in range(oCols):
            pp = pixel_poids((r, c), ratio)
            
            outputPixel = np.array([0, 0, 0])
            for (y, x, p) in pp:
                outputPixel =  outputPixel + inputImg[y][x] * p
            outputPixel = outputPixel / ratio[0]**2
            outputImg[r][c] = outputPixel.astype(np.uint8)
    return outputImg

outArray = resize(imgArray.astype(np.uint16), ratio)

img2 = Image.fromarray(outArray, "RGB")
img2.show()
